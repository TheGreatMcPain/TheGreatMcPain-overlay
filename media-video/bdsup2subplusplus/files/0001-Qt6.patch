From cfbc52081e1c939dc3721412c6f2e84ac3409f00 Mon Sep 17 00:00:00 2001
From: TheGreatMcPain <james@thegreatmcpain.xyz>
Date: Mon, 19 Jan 2026 22:15:42 -0600
Subject: [PATCH] Qt6

---
 src/Subtitles/bitmap.h    |   4 ++
 src/Subtitles/subdvd.cpp  |  12 ++--
 src/Subtitles/supxml.cpp  |   4 +-
 src/Subtitles/supxml.h    |   2 +-
 src/Tools/timeutil.cpp    |  24 +++----
 src/Tools/timeutil.h      |  10 ++-
 src/bdsup2sub++.pro       |  18 ++++-
 src/bdsup2sub.cpp         | 146 +++++++++++++++++++-------------------
 src/conversiondialog.cpp  |   8 +--
 src/conversiondialog.h    |   6 +-
 src/editdialog.cpp        |   6 +-
 src/editdialog.h          |   6 +-
 src/qxtcommandoptions.cpp |  12 ++--
 13 files changed, 141 insertions(+), 117 deletions(-)

diff --git a/src/Subtitles/bitmap.h b/src/Subtitles/bitmap.h
index 73dd018..33b5da9 100644
--- a/src/Subtitles/bitmap.h
+++ b/src/Subtitles/bitmap.h
@@ -22,7 +22,11 @@
 
 #include <QImage>
 
+#if(QT_VERSION < QT_VERSION_CHECK(6,0,0))
 template <typename T> class QVector;
+#else
+template <typename T> using QVector = QList<T>;
+#endif
 
 class Filter;
 class Palette;
diff --git a/src/Subtitles/subdvd.cpp b/src/Subtitles/subdvd.cpp
index 63fc9f8..5fdfc91 100644
--- a/src/Subtitles/subdvd.cpp
+++ b/src/Subtitles/subdvd.cpp
@@ -817,7 +817,7 @@ void SubDVD::readIdx(int idxToRead)
         // size (e.g. "size: 720x576")
         if (key == "size")
         {
-            keyValue = value.split("x", QString::SkipEmptyParts);
+            keyValue = value.split("x", Qt::SkipEmptyParts);
             if (keyValue.isEmpty() || keyValue.size() <= 1)
             {
                 throw QString("Illegal size: %1").arg(value);
@@ -842,7 +842,7 @@ void SubDVD::readIdx(int idxToRead)
         // origin (e.g. "org: 0, 0")
         if (key == "org")
         {
-            keyValue = value.split(",", QString::SkipEmptyParts);
+            keyValue = value.split(",", Qt::SkipEmptyParts);
             if (keyValue.isEmpty() || keyValue.size() <= 1)
             {
                 throw QString("Illegal origin: %1").arg(value);
@@ -968,7 +968,7 @@ void SubDVD::readIdx(int idxToRead)
         if (key == "id")
         {
             QString id;
-            QStringList vals = value.split(',', QString::SkipEmptyParts);
+            QStringList vals = value.split(',', Qt::SkipEmptyParts);
             id = vals[0];
             if (id.size() != 2)
             {
@@ -1004,7 +1004,7 @@ void SubDVD::readIdx(int idxToRead)
             {
                 subtitleProcessor->printWarning(QString("Illegal language id: %1\n").arg(id));
             }
-            vals = value.split(':', QString::SkipEmptyParts);
+            vals = value.split(':', Qt::SkipEmptyParts);
             if (vals.size() == 1)
             {
                 subtitleProcessor->printError(QString("Missing index key: %1\n").arg(value));
@@ -1052,7 +1052,7 @@ void SubDVD::readIdx(int idxToRead)
             if (key == "timestamp")
             {
                 QString vs;
-                QStringList vals = value.split(',', QString::SkipEmptyParts);
+                QStringList vals = value.split(',', Qt::SkipEmptyParts);
                 if (vals.isEmpty() || vals.size() <= 1)
                 {
                     throw QString("Illegal timestamp entry: %1").arg(value);
@@ -1065,7 +1065,7 @@ void SubDVD::readIdx(int idxToRead)
                     throw QString("Illegal timestamp: %1").arg(vals[0]);
                 }
                 vs = vals[1].trimmed().toLower();
-                vals = vs.split(':', QString::SkipEmptyParts);
+                vals = vs.split(':', Qt::SkipEmptyParts);
                 if (vals.isEmpty() || vals.size() <= 1)
                 {
                     throw QString("Missing filepos: %1").arg(value);
diff --git a/src/Subtitles/supxml.cpp b/src/Subtitles/supxml.cpp
index 828e94d..1959473 100644
--- a/src/Subtitles/supxml.cpp
+++ b/src/Subtitles/supxml.cpp
@@ -27,8 +27,8 @@
 #include "types.h"
 #include <QImage>
 #include <QFileInfo>
-#include <QtXml/QXmlSimpleReader>
-#include <QtXml/QXmlInputSource>
+#include <QXmlSimpleReader>
+#include <QXmlInputSource>
 #include <QRect>
 #include <QDir>
 #include <QPainter>
diff --git a/src/Subtitles/supxml.h b/src/Subtitles/supxml.h
index 4456766..7dca8d8 100644
--- a/src/Subtitles/supxml.h
+++ b/src/Subtitles/supxml.h
@@ -26,7 +26,7 @@
 
 #include <QObject>
 #include <QFile>
-#include <QtXml/QXmlDefaultHandler>
+#include <QXmlDefaultHandler>
 #include <QStringList>
 #include <QString>
 #include <QVector>
diff --git a/src/Tools/timeutil.cpp b/src/Tools/timeutil.cpp
index 5d1ca80..dfd3510 100644
--- a/src/Tools/timeutil.cpp
+++ b/src/Tools/timeutil.cpp
@@ -28,13 +28,13 @@ TimeUtil::TimeUtil()
 
 qint64 TimeUtil::timeStrXmlToPTS(QString s, double fps)
 {
-    if (timePattern.exactMatch(s) && timePattern.indexIn(s) != -1)
+    QRegularExpressionMatch match = timePattern.match(s);
+    if (match.hasMatch())
     {
-        QStringList m = timePattern.capturedTexts();
-        qint64 hour = m[1].toInt();
-        qint64 min = m[2].toInt();
-        qint64 sec = m[3].toInt();
-        qint64 frames = m[4].toInt();
+        qint64 hour = match.captured(1).toInt();
+        qint64 min = match.captured(2).toInt();
+        qint64 sec = match.captured(3).toInt();
+        qint64 frames = match.captured(4).toInt();
 
         qint64 temp = hour * 60;
         temp += min;
@@ -54,13 +54,13 @@ qint64 TimeUtil::timeStrToPTS(QString s, bool *ok)
     *ok = false;
     bool timestampIsNegative = s[0] == '-';
     QString temp = timestampIsNegative ? s.mid(1) : s;
-    if (timePattern.exactMatch(temp) && timePattern.indexIn(temp) != -1)
+    QRegularExpressionMatch match = timePattern.match(s);
+    if (match.hasMatch())
     {
-        QStringList m = timePattern.capturedTexts();
-        qint64 hour = m[1].toInt();
-        qint64 min = m[2].toInt();
-        qint64 sec = m[3].toInt();
-        qint64 ms  = m[4].toInt();
+        qint64 hour = match.captured(1).toInt();
+        qint64 min = match.captured(2).toInt();
+        qint64 sec = match.captured(3).toInt();
+        qint64 ms  = match.captured(4).toInt();
 
         qint64 temp = hour * 60;
         temp += min;
diff --git a/src/Tools/timeutil.h b/src/Tools/timeutil.h
index 3535f02..1e65172 100644
--- a/src/Tools/timeutil.h
+++ b/src/Tools/timeutil.h
@@ -21,11 +21,15 @@
 #define TIMEUTIL_H
 
 #include <QString>
-#include <QRegExp>
+#include <QRegularExpression>
 
+#if(QT_VERSION < QT_VERSION_CHECK(6,0,0))
 template <typename T> class QVector;
+#else
+template <typename T> using QVector = QList<T>;
+#endif
 
-static QRegExp timePattern = QRegExp("(\\d+):(\\d+):(\\d+)[:\\.](\\d+)");
+static QRegularExpression timePattern = QRegularExpression("(\\d+):(\\d+):(\\d+)[:\\.](\\d+)");
 
 class TimeUtil
 {
@@ -35,7 +39,7 @@ public:
     static qint64 timeStrToPTS(QString s, bool *ok = 0);
     static qint64 timeStrXmlToPTS(QString s, double fps);
 
-    static QRegExp getTimePattern() { return timePattern; }
+    static QRegularExpression getTimePattern() { return timePattern; }
 
     static QString ptsToTimeStrXml(qint64 pts, double fps);
     static QString ptsToTimeStr(qint64 pts);
diff --git a/src/bdsup2sub++.pro b/src/bdsup2sub++.pro
index 8a39813..10ffa2a 100644
--- a/src/bdsup2sub++.pro
+++ b/src/bdsup2sub++.pro
@@ -18,8 +18,24 @@ QT        -= gui
 QT        += widgets
 }
 CONFIG    += qt console
+greaterThan(QT_MAJOR_VERSION, 5) {
+  QT      += core5compat
+}
 DEFINES   += BUILD_QXT_CORE
-QMAKE_CXXFLAGS += -std=c++14
+win32-msvc* {
+  lessThan(QT_MAJOR_VERSION, 6) {
+    CONFIG += c++14 # C++14 support
+  } else {
+    CONFIG += c++17 # C++11 support
+    QMAKE_CXXFLAGS += /std:c++17
+  }
+} else {
+  lessThan(QT_MAJOR_VERSION, 6) {
+    QMAKE_CXXFLAGS += -std=c++14
+  } else {
+    QMAKE_CXXFLAGS += -std=c++17
+  }
+}
 TARGET     = bdsup2sub++
 TEMPLATE   = app
 
diff --git a/src/bdsup2sub.cpp b/src/bdsup2sub.cpp
index b67bc33..3d6ce2d 100644
--- a/src/bdsup2sub.cpp
+++ b/src/bdsup2sub.cpp
@@ -589,7 +589,7 @@ void BDSup2Sub::saveFile()
         QFileInfo fileInfo(fileName);
         savePath = fileInfo.absolutePath();
         saveFileName = fileInfo.completeBaseName();
-        saveFileName = saveFileName.replace(QRegExp("_exp$"), "");
+        saveFileName = saveFileName.replace(QRegularExpression("_exp$"), "");
         QString fi, fs;
 
         if (currentText.contains("IDX"))
@@ -802,15 +802,15 @@ void BDSup2Sub::printWarnings(QTextStream &stream)
 
 void BDSup2Sub::showUsage(QTextStream& outStream)
 {
-    outStream << progNameVer << " " << authorDate << endl;
-    outStream << "Syntax:" << endl;
-    outStream << QString("%1 [options] -o outfile infile").arg(progName.toLower()) << endl;
+    outStream << progNameVer << " " << authorDate << Qt::endl;
+    outStream << "Syntax:" << Qt::endl;
+    outStream << QString("%1 [options] -o outfile infile").arg(progName.toLower()) << Qt::endl;
     options->showUsage(false, outStream);
-    outStream << endl << "Wildcard support:" << endl;
-    outStream << "Use \"*\" for any character and \"?\" for one character in the source name" << endl;
-    outStream << "Use exactly one \"*\" in the target file name." << endl;
-    outStream << "Example:" << endl;
-    outStream << "bdsup2sub++ --resolution 720 --fps-target 25p -o dvd_*.sub 'movie* 1?.sup'" << endl;
+    outStream << Qt::endl << "Wildcard support:" << Qt::endl;
+    outStream << "Use \"*\" for any character and \"?\" for one character in the source name" << Qt::endl;
+    outStream << "Use exactly one \"*\" in the target file name." << Qt::endl;
+    outStream << "Example:" << Qt::endl;
+    outStream << "bdsup2sub++ --resolution 720 --fps-target 25p -o dvd_*.sub 'movie* 1?.sup'" << Qt::endl;
 }
 
 void BDSup2Sub::addCLIOptions()
@@ -945,7 +945,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
         }
         else
         {
-            errorStream << QString("ERROR: File '%1' does not exist.").arg(positional[0]) << endl;
+            errorStream << QString("ERROR: File '%1' does not exist.").arg(positional[0]) << Qt::endl;
             exit(1);
         }
     }
@@ -963,7 +963,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             QString ext = QFileInfo(trg).suffix();
             if (ext.isEmpty())
             {
-                errorStream << QString("ERROR: No extension given for target %1").arg(trg) << endl;
+                errorStream << QString("ERROR: No extension given for target %1").arg(trg) << Qt::endl;
                 exit(1);
             }
             if (ext == "sup")
@@ -984,7 +984,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             }
             else
             {
-                errorStream << QString("ERROR: Unknown extension of target %1").arg(trg) << endl;
+                errorStream << QString("ERROR: Unknown extension of target %1").arg(trg) << Qt::endl;
                 exit(1);
             }
         }
@@ -1008,12 +1008,12 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
 
             if (srcFiles.size() == 0)
             {
-                errorStream << QString("ERROR: No match found for '%1'").arg(src) << endl;
+                errorStream << QString("ERROR: No match found for '%1'").arg(src) << Qt::endl;
                 exit(1);
             }
             if (trg.indexOf('*') == -1)
             {
-                errorStream << "ERROR: No wildcards in target string!" << endl;
+                errorStream << "ERROR: No wildcards in target string!" << Qt::endl;
                 exit(1);
             }
             for (int i = 0; i < srcFiles.size(); ++i)
@@ -1068,7 +1068,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             ival = ok ? ival : -1;
             if (ival < 0 || ival > 255)
             {
-                errorStream << QString("ERROR: Illegal number range for alpha threshold: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Illegal number range for alpha threshold: %1").arg(value) << Qt::endl;
                 exit(1);
             }
             else
@@ -1076,7 +1076,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 alphaThreshold = ival;
                 setAlphaThreshold = true;
             }
-            outStream << QString("OPTION: Set alpha threshold to %1").arg(value) << endl;
+            outStream << QString("OPTION: Set alpha threshold to %1").arg(value) << Qt::endl;
         }
 
         if (options->count("med-low-thr"))
@@ -1086,7 +1086,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             ival = ok ? ival : -1;
             if (ival <0 || ival > 255)
             {
-                errorStream << QString("ERROR: Illegal number range for luminance: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Illegal number range for luminance: %1").arg(value) << Qt::endl;
                 exit(1);
             }
             else
@@ -1094,7 +1094,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 lumThr1 = ival;
                 setLumaThreshold = true;
             }
-            outStream << QString("OPTION: Set med/low luminance threshold to %1").arg(value) << endl;
+            outStream << QString("OPTION: Set med/low luminance threshold to %1").arg(value) << Qt::endl;
         }
 
         if (options->count("med-hi-thr"))
@@ -1104,7 +1104,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             ival = ok ? ival : -1;
             if (ival <0 || ival > 255)
             {
-                errorStream << QString("ERROR: Illegal number range for luminance: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Illegal number range for luminance: %1").arg(value) << Qt::endl;
                 exit(1);
             }
             else
@@ -1112,7 +1112,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 lumThr2 = ival;
                 setLumaThreshold = true;
             }
-            outStream << QString("OPTION: Set med/hi luminance threshold to %1").arg(value) << endl;
+            outStream << QString("OPTION: Set med/hi luminance threshold to %1").arg(value) << Qt::endl;
         }
 
         if (options->count("resolution"))
@@ -1171,12 +1171,12 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 else
                 {
                     errorStream << QString("ERROR: Illegal resolution: %1")
-                                   .arg(value) << endl;
+                                   .arg(value) << Qt::endl;
                     exit(1);
                 }
                 subtitleProcessor->setOutputResolution(resolution);
                 outStream << QString("OPTION: Set resolution to %1")
-                             .arg(subtitleProcessor->getResolutionName(resolution)) << endl;
+                             .arg(subtitleProcessor->getResolutionName(resolution)) << Qt::endl;
             }
         }
 
@@ -1194,19 +1194,19 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             }
             if (langIdx == -1)
             {
-                errorStream << QString("ERROR: Unknown language %1").arg(value) << endl;
-                errorStream << "Use one of the following 2 character codes:" << endl;
+                errorStream << QString("ERROR: Unknown language %1").arg(value) << Qt::endl;
+                errorStream << "Use one of the following 2 character codes:" << Qt::endl;
                 for (int l = 0; l < subtitleProcessor->getLanguages().size(); ++l)
                 {
                     errorStream << QString("    %1 - %2")
                                    .arg(subtitleProcessor->getLanguages()[l][1])
-                                   .arg(subtitleProcessor->getLanguages()[l][0]) << endl;
+                                   .arg(subtitleProcessor->getLanguages()[l][0]) << Qt::endl;
                 }
                 exit(1);
             }
             outStream << QString("OPTION: Set language to %1 (%2)")
                          .arg(subtitleProcessor->getLanguages()[langIdx][0])
-                         .arg(subtitleProcessor->getLanguages()[langIdx][1]) << endl;
+                         .arg(subtitleProcessor->getLanguages()[langIdx][1]) << Qt::endl;
             subtitleProcessor->setLanguageIdxSet(true);
         }
 
@@ -1216,7 +1216,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             QFileInfo f(value);
             if (!f.exists())
             {
-                errorStream << QString("ERROR: No palette file found at: %1").arg(value) << endl;
+                errorStream << QString("ERROR: No palette file found at: %1").arg(value) << Qt::endl;
                 exit(1);
             }
 
@@ -1228,7 +1228,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             file.close();
             if (header != "#COL")
             {
-                errorStream << "ERROR: Not a valid palette file" << endl;
+                errorStream << "ERROR: Not a valid palette file" << Qt::endl;
                 exit(1);
             }
 
@@ -1250,19 +1250,19 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                     importedPalette.setColor(c + 1, QColor(red, green, blue, 0));
                 }
             }
-            outStream << QString("OPTION: Loaded palette from %1").arg(value) << endl;
+            outStream << QString("OPTION: Loaded palette from %1").arg(value) << Qt::endl;
         }
 
         if (options->count("forced-only"))
         {
             subtitleProcessor->setExportForced(true);
-            outStream << "OPTION: Exporting only forced subtitles." << endl;
+            outStream << "OPTION: Exporting only forced subtitles." << Qt::endl;
         }
 
         if (options->count("swap"))
         {
             subtitleProcessor->setSwapCrCb(true);
-            outStream << "OPTION: Swapping Cr/Cb components." << endl;
+            outStream << "OPTION: Swapping Cr/Cb components." << Qt::endl;
         }
 
         if (options->count("fps-source"))
@@ -1279,11 +1279,11 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 else
                 {
                     errorStream << QString("ERROR: Invalid source framerate: %1")
-                                   .arg(value) << endl;
+                                   .arg(value) << Qt::endl;
                     exit(1);
                 }
             }
-            outStream << QString("OPTION: synchronize target framerate to %1").arg(value) << endl;
+            outStream << QString("OPTION: synchronize target framerate to %1").arg(value) << Qt::endl;
         }
 
         if (options->count("fps-target"))
@@ -1302,12 +1302,12 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 else
                 {
                     errorStream << QString("ERROR: Invalid target framerate: %1")
-                                   .arg(value) << endl;
+                                   .arg(value) << Qt::endl;
                     exit(1);
                 }
                 outStream << QString("OPTION: Converting framerate from %1fps to %2fps")
                              .arg(QString::number(subtitleProcessor->getFPSSrc(), 'g', 6))
-                             .arg(QString::number(subtitleProcessor->getFPSTrg(), 'g', 6)) << endl;
+                             .arg(QString::number(subtitleProcessor->getFPSTrg(), 'g', 6)) << Qt::endl;
             }
             else
             {
@@ -1329,13 +1329,13 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
 
             if (!ok)
             {
-                errorStream << QString("ERROR: Illegal delay value: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Illegal delay value: %1").arg(value) << Qt::endl;
                 exit(1);
             }
             int delayPTS = (int)subtitleProcessor->syncTimePTS((qint64)delay, subtitleProcessor->getFPSTrg());
             subtitleProcessor->setDelayPTS(delayPTS);
             outStream << QString("OPTION: Set delay to %1")
-                         .arg(QString::number(delayPTS / 90.0, 'g', 6)) << endl;
+                         .arg(QString::number(delayPTS / 90.0, 'g', 6)) << Qt::endl;
         }
 
         if (options->count("minimum-time"))
@@ -1349,14 +1349,14 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             if (!ok)
             {
                 errorStream << QString("ERROR: Illegal value for minimum display time: %1")
-                               .arg(value) << endl;
+                               .arg(value) << Qt::endl;
                 exit(1);
             }
             int tMin = (int)subtitleProcessor->syncTimePTS((qint64)time, subtitleProcessor->getFPSTrg());
             subtitleProcessor->setMinTimePTS(tMin);
             subtitleProcessor->setFixShortFrames(true);
             outStream << QString("OPTION: Set minimum display time to %1")
-                         .arg(QString::number(tMin / 90.0, 'g', 6)) << endl;
+                         .arg(QString::number(tMin / 90.0, 'g', 6)) << Qt::endl;
         }
 
         double screenRatio = -1;
@@ -1381,7 +1381,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
 
             if (screenRatio <= (16.0 / 9))
             {
-                errorStream << QString("ERROR: Invalid screen ratio: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Invalid screen ratio: %1").arg(value) << Qt::endl;
                 exit(1);
             }
 
@@ -1392,7 +1392,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 int moveOffsetY = value.toInt(&ok);
                 if (!ok)
                 {
-                    errorStream << QString("ERROR: Invalid pixel offset: %1").arg(value) << endl;
+                    errorStream << QString("ERROR: Invalid pixel offset: %1").arg(value) << Qt::endl;
                     exit(1);
                 }
                 subtitleProcessor->setMoveOffsetY(moveOffsetY);
@@ -1401,7 +1401,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             outStream << QString("OPTION: Moving captions %1 %2:1 plus/minus %3 pixels")
                          .arg(sm)
                          .arg(QString::number(screenRatio, 'g', 6))
-                         .arg(QString::number(subtitleProcessor->getMoveOffsetY())) << endl;
+                         .arg(QString::number(subtitleProcessor->getMoveOffsetY())) << Qt::endl;
         }
 
         if (options->count("move-y-origin"))
@@ -1416,7 +1416,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 int moveOffsetY = value.toInt(&ok);
                 if (!ok)
                 {
-                    errorStream << QString("ERROR: Invalid pixel offset: %1").arg(value) << endl;
+                    errorStream << QString("ERROR: Invalid pixel offset: %1").arg(value) << Qt::endl;
                     exit(1);
                 }
                 if (sm == "up")
@@ -1426,7 +1426,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 subtitleProcessor->setMoveOffsetY(moveOffsetY);
             }
             outStream << QString("OPTION: Moving captions from the original Y position plus/minus %1 pixels")
-                         .arg(QString::number(subtitleProcessor->getMoveOffsetY())) << endl;
+                         .arg(QString::number(subtitleProcessor->getMoveOffsetY())) << Qt::endl;
         }
 
         if (options->count("move-x"))
@@ -1451,7 +1451,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             }
             else
             {
-                errorStream << QString("ERROR: Invalid moveX command: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Invalid moveX command: %1").arg(value) << Qt::endl;
                 exit(1);
             }
 
@@ -1464,14 +1464,14 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 int moveOffsetX = value.toInt(&ok);
                 if (!ok)
                 {
-                    errorStream << QString("ERROR: Invalid pixel offset: %1").arg(value) << endl;
+                    errorStream << QString("ERROR: Invalid pixel offset: %1").arg(value) << Qt::endl;
                     exit(1);
                 }
                 subtitleProcessor->setMoveOffsetX(moveOffsetX);
             }
             outStream << QString("OPTION: Moving captions to the %1 plus/minus %2 pixels")
                          .arg(mx)
-                         .arg(QString::number(subtitleProcessor->getMoveOffsetX())) << endl;
+                         .arg(QString::number(subtitleProcessor->getMoveOffsetX())) << Qt::endl;
         }
 
         if (options->count("crop-y"))
@@ -1484,11 +1484,11 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             if (ok && cropY > 0)
             {
                 subtitleProcessor->setCropOfsY(cropY);
-                outStream << QString("OPTION: Set delay to %1").arg(value) << endl;
+                outStream << QString("OPTION: Set delay to %1").arg(value) << Qt::endl;
             }
             else
             {
-                errorStream << QString("ERROR: Invalid crop y value: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Invalid crop y value: %1").arg(value) << Qt::endl;
             }
         }
 
@@ -1510,21 +1510,21 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             }
             else
             {
-                errorStream << QString("ERROR: Invalid palette mode: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Invalid palette mode: %1").arg(value) << Qt::endl;
                 exit(1);
             }
-            outStream << QString("OPTION: Set palette mode to %1").arg(value) << endl;
+            outStream << QString("OPTION: Set palette mode to %1").arg(value) << Qt::endl;
         }
 
         if (options->count("verbose"))
         {
             subtitleProcessor->setVerbatim(true);
-            outStream << QString("OPTION: Enabled verbose output.") << endl;
+            outStream << QString("OPTION: Enabled verbose output.") << Qt::endl;
         }
         if (options->count("no-verbose"))
         {
             subtitleProcessor->setVerbatim(false);
-            outStream << QString("OPTION: Disabled verbose output.") << endl;
+            outStream << QString("OPTION: Disabled verbose output.") << Qt::endl;
         }
 
         if (options->count("filter"))
@@ -1546,11 +1546,11 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             if (idx != -1)
             {
                 subtitleProcessor->setScalingFilter((ScalingFilters)idx);
-                outStream << QString("OPTION: Set scaling filter to: %1").arg(value) << endl;
+                outStream << QString("OPTION: Set scaling filter to: %1").arg(value) << Qt::endl;
             }
             else
             {
-                errorStream << QString("ERROR: Invalid scaling filter: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Invalid scaling filter: %1").arg(value) << Qt::endl;
                 exit(1);
             }
         }
@@ -1568,12 +1568,12 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
 
             if (!ok)
             {
-                errorStream << QString("ERROR: Illegal value for maximum merge time: %1").arg(value) << endl;
+                errorStream << QString("ERROR: Illegal value for maximum merge time: %1").arg(value) << Qt::endl;
                 exit(1);
             }
             int ti = (int)(time + 0.5);
             subtitleProcessor->setMergePTSdiff(ti);
-            outStream << QString("OPTION: Set maximum merge time to %1").arg(QString::number(ti / 90.0, 'g', 6)) << endl;
+            outStream << QString("OPTION: Set maximum merge time to %1").arg(QString::number(ti / 90.0, 'g', 6)) << Qt::endl;
         }
 
         if (options->count("scale-x") || options->count("scale-y"))
@@ -1586,7 +1586,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 scaleX = value.toDouble(&ok);
                 if (!ok)
                 {
-                    errorStream << QString("ERROR: Invalid x scaling factor: %1").arg(value) << endl;
+                    errorStream << QString("ERROR: Invalid x scaling factor: %1").arg(value) << Qt::endl;
                     exit(1);
                 }
             }
@@ -1598,7 +1598,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 scaleY = value.toDouble(&ok);
                 if (!ok)
                 {
-                    errorStream << QString("ERROR: Invalid y scaling factor: %1").arg(value) << endl;
+                    errorStream << QString("ERROR: Invalid y scaling factor: %1").arg(value) << Qt::endl;
                     exit(1);
                 }
             }
@@ -1607,7 +1607,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             subtitleProcessor->setApplyFreeScale(true);
             outStream << QString("OPTION: Set free scaling factors to %1, %2")
                          .arg(QString::number(scaleX, 'g', 6))
-                         .arg(QString::number(scaleY, 'g', 6)) << endl;
+                         .arg(QString::number(scaleY, 'g', 6)) << Qt::endl;
         }
 
         if (options->count("alpha-crop"))
@@ -1619,20 +1619,20 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             if (ival < 0 || ival > 255)
             {
                 errorStream << QString("ERROR: Illegal number range for alpha cropping threshold: %1")
-                               .arg(value) << endl;
+                               .arg(value) << Qt::endl;
                 exit(1);
             }
             else
             {
                 subtitleProcessor->setAlphaCrop(ival);
             }
-            outStream << QString("OPTION: Set alpha cropping threshold to %1").arg(value) << endl;
+            outStream << QString("OPTION: Set alpha cropping threshold to %1").arg(value) << Qt::endl;
         }
 
         if (options->count("export-palette"))
         {
             subtitleProcessor->setWritePGCEditPal(true);
-            outStream << QString("OPTION: Export target palette in PGCEDit text format") << endl;
+            outStream << QString("OPTION: Export target palette in PGCEDit text format") << Qt::endl;
         }
         if (options->count("no-export-palette"))
         {
@@ -1642,7 +1642,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
         if (options->count("fix-invisible"))
         {
             subtitleProcessor->setFixZeroAlpha(true);
-            outStream << QString("OPTION: Fix zero alpha frame palette for SUB/IDX and SUP/IFO") << endl;
+            outStream << QString("OPTION: Fix zero alpha frame palette for SUB/IDX and SUP/IFO") << Qt::endl;
         }
         if (options->count("no-fix-invisible"))
         {
@@ -1655,11 +1655,11 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             if (value == "set" || value == "clear")
             {
                 subtitleProcessor->setForceAll(value == "set" ? SetState::SET : SetState::CLEAR);
-                outStream << QString("OPTION: Set forced state of all captions to: %1").arg(value) << endl;
+                outStream << QString("OPTION: Set forced state of all captions to: %1").arg(value) << Qt::endl;
             }
             else
             {
-                errorStream << QString("Invalid set state: %1").arg(value) << endl;
+                errorStream << QString("Invalid set state: %1").arg(value) << Qt::endl;
                 exit(1);
             }
         }
@@ -1686,12 +1686,12 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
 
             try
             {
-                outStream << QString("\nConverting %1\n").arg(modes[(int)mode]) << endl;
+                outStream << QString("\nConverting %1\n").arg(modes[(int)mode]) << Qt::endl;
 
                 QFileInfo srcFileInfo(src);
                 if (!srcFileInfo.exists())
                 {
-                    errorStream << QString("ERROR: File '%1' does not exist.").arg(QDir::toNativeSeparators(src)) << endl;
+                    errorStream << QString("ERROR: File '%1' does not exist.").arg(QDir::toNativeSeparators(src)) << Qt::endl;
                     exit(1);
                 }
 
@@ -1703,7 +1703,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 StreamID sid = (id.isEmpty()) ? StreamID::UNKNOWN : subtitleProcessor->getStreamID(id);
                 if (!idx && !xml && !ifo && sid == StreamID::UNKNOWN)
                 {
-                    errorStream << QString("File '%1' is not a supported subtitle stream.").arg(src) << endl;
+                    errorStream << QString("File '%1' is not a supported subtitle stream.").arg(src) << Qt::endl;
                     exit(1);
                 }
 
@@ -1727,7 +1727,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 {
                     if ((fi.exists() && !fi.isWritable()) || (fs.exists() && !fs.isWritable()))
                     {
-                        errorStream << QString("Target file '%1' is write protected.").arg(trg) << endl;
+                        errorStream << QString("Target file '%1' is write protected.").arg(trg) << Qt::endl;
                         exit(1);
                     }
                 }
@@ -1808,7 +1808,7 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
                 }
                 if (subtitleProcessor->getExportForced() && subtitleProcessor->getNumForcedFrames()==0)
                 {
-                    errorStream << "No forced subtitles found." << endl;
+                    errorStream << "No forced subtitles found." << Qt::endl;
                     exit(1);
                 }
 
@@ -1816,14 +1816,14 @@ bool BDSup2Sub::execCLI(int /*argc*/, char** /*argv*/)
             }
             catch(QString e)
             {
-                errorStream << QString("ERROR: %1").arg(e) << endl;
+                errorStream << QString("ERROR: %1").arg(e) << Qt::endl;
                 exit(1);
             }
 
             printWarnings(outStream);
             subtitleProcessor->exit();
         }
-        outStream << QString("\nConversion of %1 file(s) finished\n").arg(QString::number(srcFileNames.size())) << endl;
+        outStream << QString("\nConversion of %1 file(s) finished\n").arg(QString::number(srcFileNames.size())) << Qt::endl;
     }
     exit(0);
 }
diff --git a/src/conversiondialog.cpp b/src/conversiondialog.cpp
index 04e8aaa..24841b5 100644
--- a/src/conversiondialog.cpp
+++ b/src/conversiondialog.cpp
@@ -31,7 +31,7 @@
 #endif
 
 #include <QDoubleValidator>
-#include <QRegExpValidator>
+#include <QRegularExpressionValidator>
 #include <QPalette>
 #include <QKeyEvent>
 #include <QSettings>
@@ -47,9 +47,9 @@ ConversionDialog::ConversionDialog(QWidget *parent, SubtitleProcessor *subtitleP
     this->subtitleProcessor = subtitleProcessor;
     this->settings = settings;
 
-    QRegExp regex("[0-9]+([.][0-9]+)?|pal|25p|ntsc|30p|24p|50i|60i");
-    fpsSrcValidator = new QRegExpValidator(regex);
-    fpsTrgValidator = new QRegExpValidator(regex);
+    QRegularExpression regex("[0-9]+([.][0-9]+)?|pal|25p|ntsc|30p|24p|50i|60i");
+    fpsSrcValidator = new QRegularExpressionValidator(regex, this);
+    fpsTrgValidator = new QRegularExpressionValidator(regex, this);
     scaleXValidator = new QDoubleValidator;
     scaleYValidator = new QDoubleValidator;
     delayPTSValidator = new QDoubleValidator;
diff --git a/src/conversiondialog.h b/src/conversiondialog.h
index e0b9cad..1d77ec1 100644
--- a/src/conversiondialog.h
+++ b/src/conversiondialog.h
@@ -30,7 +30,7 @@
 class QPalette;
 class SubtitleProcessor;
 class QDoubleValidator;
-class QRegExpValidator;
+class QRegularExpressionValidator;
 class QSettings;
 
 enum class Resolution : int;
@@ -87,8 +87,8 @@ private:
     Ui::ConversionDialog *ui;
     SubtitleProcessor *subtitleProcessor;
 
-    QRegExpValidator* fpsSrcValidator;
-    QRegExpValidator* fpsTrgValidator;
+    QRegularExpressionValidator* fpsSrcValidator;
+    QRegularExpressionValidator* fpsTrgValidator;
     QDoubleValidator* scaleXValidator;
     QDoubleValidator* scaleYValidator;
     QDoubleValidator* delayPTSValidator;
diff --git a/src/editdialog.cpp b/src/editdialog.cpp
index 1c600ed..892eaed 100644
--- a/src/editdialog.cpp
+++ b/src/editdialog.cpp
@@ -29,7 +29,7 @@
 #include <QKeyEvent>
 #include <QDoubleValidator>
 #include <QIntValidator>
-#include <QRegExpValidator>
+#include <QRegularExpressionValidator>
 
 EditDialog::EditDialog(QWidget *parent, SubtitleProcessor* subtitleProcessor) :
     QDialog(parent),
@@ -67,9 +67,9 @@ EditDialog::EditDialog(QWidget *parent, SubtitleProcessor* subtitleProcessor) :
     ui->xOffsetLineEdit->setValidator(xOffsetValidator);
     yOffsetValidator = new QIntValidator;
     ui->yOffsetLineEdit->setValidator(yOffsetValidator);
-    startTimeValidator = new QRegExpValidator(TimeUtil::getTimePattern());
+    startTimeValidator = new QRegularExpressionValidator(TimeUtil::getTimePattern(), this);
     ui->startTimeLineEdit->setValidator(startTimeValidator);
-    endTimeValidator = new QRegExpValidator(TimeUtil::getTimePattern());
+    endTimeValidator = new QRegularExpressionValidator(TimeUtil::getTimePattern(), this);
     ui->endTimeLineEdit->setValidator(endTimeValidator);
 
     this->resize(minimumWidth + 36, minimumHeight + 280);
diff --git a/src/editdialog.h b/src/editdialog.h
index d5133b9..b159cb5 100644
--- a/src/editdialog.h
+++ b/src/editdialog.h
@@ -32,7 +32,7 @@ class SubPicture;
 class QImage;
 class QDoubleValidator;
 class QIntValidator;
-class QRegExpValidator;
+class QRegularExpressionValidator;
 class QPalette;
 
 namespace Ui {
@@ -101,8 +101,8 @@ private:
     QDoubleValidator* durationValidator;
     QIntValidator* xOffsetValidator;
     QIntValidator* yOffsetValidator;
-    QRegExpValidator* startTimeValidator;
-    QRegExpValidator* endTimeValidator;
+    QRegularExpressionValidator* startTimeValidator;
+    QRegularExpressionValidator* endTimeValidator;
     QPalette* errorBackground;
     QPalette* warnBackground;
     QPalette* okBackground;
diff --git a/src/qxtcommandoptions.cpp b/src/qxtcommandoptions.cpp
index 14c040d..b935b2c 100644
--- a/src/qxtcommandoptions.cpp
+++ b/src/qxtcommandoptions.cpp
@@ -753,10 +753,10 @@ bool QxtCommandOptions::showUnrecognizedWarning(QTextStream& stream) const
         name = "QxtCommandOptions";
 
     if (qxt_d().unrecognized.count())
-        stream << name << ": " << tr("unrecognized parameters: ") << qxt_d().unrecognized.join(" ") << endl;
+        stream << name << ": " << tr("unrecognized parameters: ") << qxt_d().unrecognized.join(" ") << Qt::endl;
 
     foreach(const QString& param, qxt_d().missingParams)
-        stream << name << ": " << tr("%1 requires a parameter").arg(param) << endl;
+        stream << name << ": " << tr("%1 requires a parameter").arg(param) << Qt::endl;
 
     return true;
 }
@@ -900,19 +900,19 @@ void QxtCommandOptions::showUsage(bool showQtOptions, QTextStream& stream) const
         if (names[i].isEmpty())
         {
             // Section headers have no name entry
-            stream << endl << descs[i] << ":" << endl;
+            stream << Qt::endl << descs[i] << ":" << Qt::endl;
             continue;
         }
         line = ' ' + names[i] + QString(maxNameLength - names[i].length() + 2, ' ');
-        foreach(const QString& word, descs[i].split(' ', QString::SkipEmptyParts))
+        foreach(const QString& word, descs[i].split(' ', Qt::SkipEmptyParts))
         {
             if (qxt_d().screenWidth > 0 && line.length() + word.length() >= qxt_d().screenWidth)
             {
-                stream << line << endl;
+                stream << line << Qt::endl;
                 line = wrap;
             }
             line += word + ' ';
         }
-        stream << line << endl;
+        stream << line << Qt::endl;
     }
 }
-- 
2.52.0

